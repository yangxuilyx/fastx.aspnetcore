import{a as Ie,b as De}from"./chunk-HX46T5TW.js";import{a as we,b as Me}from"./chunk-LFYJK5GB.js";import{b as xe,c as Ve}from"./chunk-NN5I4ZQ6.js";import{a as ye,b as Fe,c as Ne}from"./chunk-36JYQPX4.js";import"./chunk-JQ4W37JH.js";import"./chunk-GOVML6XL.js";import{b as Se}from"./chunk-JM4Q6M5A.js";import{a as Z}from"./chunk-GGEG7LNG.js";import{k as ge,l as be,m as Te,n as ve}from"./chunk-QA3WNWTC.js";import"./chunk-ZV26Q6Z5.js";import"./chunk-4V3WCFNY.js";import{R as se,S as me,T as pe,U as de,V as ce,ba as ue,d as G,da as fe,e as z,f as H,fa as he,g as W,k as Q,l as $,o as J,q as K,r as X,s as Y,v as ae,w as le}from"./chunk-K3UCEQBL.js";import"./chunk-HLMBJXKN.js";import{a as Ee}from"./chunk-AAN5EPXW.js";import"./chunk-TH67R3V7.js";import"./chunk-3OVYBGXJ.js";import"./chunk-C6FDTAOV.js";import"./chunk-IUQ3UXTC.js";import{Na as ie,Oa as ne,Qa as re,Ra as oe,gb as _e,ia as ee,ja as te,kb as Ce,pb as F,qb as ze}from"./chunk-R2HTRB5T.js";import"./chunk-HDIAUTON.js";import"./chunk-YRUIOUIJ.js";import{p as P,y as j}from"./chunk-FBUG2U6C.js";import{$a as O,Db as C,Fb as x,Hb as V,Ib as I,Jb as r,Kb as o,Lb as u,Mb as D,Nb as w,P as b,Pb as M,Xb as h,Zb as _,bc as B,cc as d,jb as p,kb as f,kc as y,lc as U,ma as g,mb as E,oa as T,ob as N,ta as v,tb as m,ua as S,vc as A,wc as R,yc as q,zc as k}from"./chunk-25RHYGPJ.js";import"./chunk-W7ODNIXK.js";function Ae(i,a){if(i&1&&u(0,"nz-option",14),i&2){let l=a.$implicit;m("nzLabel",l.name)("nzValue",l.ouId)}}function Re(i,a){if(i&1&&u(0,"nz-option",14),i&2){let l=a.$implicit;m("nzLabel",l.name)("nzValue",l.userId)}}function qe(i,a){if(i&1&&(D(0),u(1,"span",15),r(2,"div",16),d(3,"Upload"),o(),w()),i&2){let l=_(2);p(1),m("nzType",l.loading?"loading":"plus")}}function Pe(i,a){if(i&1&&u(0,"img",17),i&2){let l=_(2);m("src",l.avatarUrl,O)}}function je(i,a){if(i&1&&(D(0),r(1,"form",2)(2,"nz-form-item")(3,"nz-form-label",3),d(4,"\u53C2\u4F1A\u90E8\u95E8"),o(),r(5,"nz-form-control")(6,"nz-select",4),V(7,Ae,1,2,"nz-option",14,x),o()()(),r(9,"nz-form-item")(10,"nz-form-label",5),d(11,"\u53C2\u4E0E\u515A\u5458"),o(),r(12,"nz-form-control")(13,"nz-select",6),V(14,Re,1,2,"nz-option",14,x),o()()(),r(16,"nz-form-item")(17,"nz-form-label",5),d(18,"\u5DE5\u4F5C\u6807\u9898"),o(),r(19,"nz-form-control"),u(20,"input",7),o()(),r(21,"nz-form-item")(22,"nz-form-label",5),d(23,"\u5F00\u59CB\u65F6\u95F4"),o(),r(24,"nz-form-control"),u(25,"nz-date-picker",8),o()(),r(26,"nz-form-item")(27,"nz-form-label",5),d(28,"\u7ED3\u675F\u65F6\u95F4"),o(),r(29,"nz-form-control"),u(30,"nz-date-picker",9),o()(),r(31,"nz-form-item")(32,"nz-form-label",5),d(33,"\u4F1A\u8BAE\u56FE\u7247"),o(),r(34,"nz-form-control")(35,"nz-upload",10),C(36,qe,4,1,"ng-container",11)(37,Pe,1,1,"img",12),o()()(),r(38,"nz-form-item")(39,"nz-form-label",5),d(40,"\u5185\u5BB9"),o(),r(41,"nz-form-control")(42,"nz-input-group"),u(43,"textarea",13),o()()()(),w()),i&2){let l=_();p(1),m("formGroup",l.validateForm),p(6),I(l.ous),p(7),I(l.users),p(21),m("nzShowUploadList",!1)("nzCustomRequest",l.nzCustomRequest),p(1),m("ngIf",!l.avatarUrl),p(1),m("ngIf",l.avatarUrl),p(6),m("rows",10)}}var Ge=()=>({padding:"15px","max-height":"70vh"}),ke=(()=>{let a=class a{get isVisible(){return this._isVisible}set isVisible(e){this._isVisible=e,e&&this.entity&&this.validateForm.patchValue(Object.assign({},this.entity,{ous:this.entity.ous.map(t=>t.ouId),users:this.entity.users.map(t=>t.userId)}))}get avatarUrl(){return this.validateForm.value.pic?this.fileClient.getBaseUrl("")+"/"+this.validateForm.value.pic:""}set avatarUrl(e){this.validateForm.controls.pic.setValue(e),this.validateForm.value.pic=e,this.cdr.detectChanges()}constructor(e,t,n,s,c){this.client=e,this.fb=t,this.ouClient=n,this.userClient=s,this.fileClient=c,this._isVisible=!1,this.isVisibleChange=new N,this.onSuccess=new N,this.loading=!1,this.cdr=g(E),this.validateForm=this.fb.group({threeId:[],title:[null,z.required],startTime:[null,z.required],endTime:[null,z.required],pic:[""],content:[""],users:[[],z.required],ous:[[],z.required]}),this.ous=[],this.users=[],this.nzCustomRequest=L=>(this.loading=!0,this.fileClient.upload({data:L.file,fileName:L.file.name}).pipe(b(()=>{this.loading=!1})).subscribe(Le=>{this.avatarUrl=Le.url}))}ngOnInit(){this.getSelectData()}getSelectData(){this.ouClient.getAll().subscribe(e=>{this.ous=e}),this.userClient.getAll().subscribe(e=>{this.users=e})}handleCancel(){this.validateForm.reset(),this.isVisibleChange.emit(!1)}handleOk(){Z(this.validateForm)&&this.client.insertOrUpdate(this.validateForm.value).subscribe(()=>{this.onSuccess.emit(),this.handleCancel()})}};a.\u0275fac=function(t){return new(t||a)(f(F),f(K),f(Ce),f(ze),f(_e))},a.\u0275cmp=T({type:a,selectors:[["app-three-edit"]],inputs:{isVisible:"isVisible",entity:"entity"},outputs:{isVisibleChange:"isVisibleChange",onSuccess:"onSuccess"},standalone:!0,features:[y],decls:2,vars:3,consts:[["nzTitle","\u7F16\u8F91\u4E09\u4F1A\u4E00\u8BFE","nzxModalDrag","","nzWidth","60%",3,"nzVisible","nzBodyStyle","nzVisibleChange","nzOnCancel","nzOnOk"],[4,"nzModalContent"],["nz-form","",3,"formGroup"],["nzRequired","","nzSpan","2"],["nzAllowClear","","nzShowSearch","","nzMode","multiple","formControlName","ous"],["nzSpan","2","nzRequired",""],["nzAllowClear","","nzShowSearch","","nzMode","multiple","formControlName","users"],["nz-input","","formControlName","title"],["formControlName","startTime"],["formControlName","endTime"],["nzName","avatar","nzListType","picture-card",1,"avatar-uploader",3,"nzShowUploadList","nzCustomRequest"],[4,"ngIf"],["style","width: 100%",3,"src",4,"ngIf"],["nz-input","","formControlName","content",3,"rows"],[3,"nzLabel","nzValue"],["nz-icon","",1,"upload-icon",3,"nzType"],[1,"ant-upload-text"],[2,"width","100%",3,"src"]],template:function(t,n){t&1&&(r(0,"nz-modal",0),h("nzVisibleChange",function(c){return n.isVisible=c})("nzOnCancel",function(){return n.handleCancel()})("nzOnOk",function(){return n.handleOk()}),C(1,je,44,6,"ng-container",1),o()),t&2&&m("nzVisible",n.isVisible)("nzBodyStyle",U(2,Ge))},dependencies:[j,P,X,Q,G,H,W,Y,$,J,ce,le,ae,me,se,de,pe,ve,Te,be,Ne,ye,Fe,he,ue,fe,De,Ie,Me,we,te,ee]});let i=a;return i})();var He=["operationTpl"];function We(i,a){if(i&1){let l=M();r(0,"span",7),h("click",function(){let n=v(l).item,s=_();return S(s.edit(n))}),d(1,"\u7F16\u8F91"),o(),r(2,"span",7),h("click",function(){let n=v(l).item,s=_();return S(s.del(n))}),d(3,"\u5220\u9664"),o()}}function Qe(i,a){if(i&1){let l=M();r(0,"button",8),h("click",function(){v(l);let t=_();return S(t.add())}),u(1,"i",9),d(2," \u65B0\u5EFA "),o()}}var wt=(()=>{let a=class a{constructor(e,t){this.client=e,this.modalService=t,this.pageHeaderInfo={breadcrumb:["\u9996\u9875","\u8003\u6838\u76D1\u7763\u5E73\u53F0","\u4E09\u4F1A\u4E00\u8BFE"]},this.cdr=g(E),this.modalWrapService=g(Se),this.dataList=[],this.isEditVisible=!1}ngOnInit(){this.initTable()}initTable(){this.tableConfig={headers:[{title:"\u5DE5\u4F5C\u4EFB\u52A1\u540D\u79F0",field:"title",width:200},{title:"\u53C2\u4E0E\u90E8\u95E8",field:"ouNames"},{title:"\u53C2\u4E0E\u515A\u5458",field:"userNames"},{title:"\u5F00\u59CB\u65F6\u95F4",field:"startTime",pipe:"date:yyyy-MM-dd"},{title:"\u7ED3\u675F\u65F6\u95F4",field:"endTime",pipe:"date:yyyy-MM-dd"},{title:"\u64CD\u4F5C",tdTemplate:this.operationTpl,width:120,fixed:!0,fixedDir:"right"}],total:0,showCheckbox:!1,loading:!1,pageSize:10,pageIndex:1}}getDataList(e){this.tableConfig.loading=!0;let t={page:{pageSize:this.tableConfig.pageSize,pageIndex:e?.pageIndex||this.tableConfig.pageIndex}};this.client.list(t).pipe(b(()=>{this.tableLoading(!1)})).subscribe(n=>{let{items:s,page:c}=n;this.dataList=[...s],this.tableConfig.total=c.totalCount,this.tableConfig.pageIndex=c.pageIndex,this.tableLoading(!1)})}add(){this.selectedEntity=null,this.isEditVisible=!0}edit(e){this.selectedEntity=e,this.isEditVisible=!0}del(e){this.modalService.confirm({nzTitle:"\u786E\u5B9A\u5220\u9664?",nzOnOk:()=>{this.client.delete(e.threeId).subscribe(t=>{this.getDataList()})}})}tableLoading(e){this.tableConfig.loading=e,this.tableChangeDectction()}tableChangeDectction(){this.dataList=[...this.dataList],this.cdr.detectChanges()}changePageSize(e){this.tableConfig.pageSize=e}};a.\u0275fac=function(t){return new(t||a)(f(F),f(ge))},a.\u0275cmp=T({type:a,selectors:[["app-three"]],viewQuery:function(t,n){if(t&1&&R(He,7),t&2){let s;A(s=q())&&(n.operationTpl=s.first)}},standalone:!0,features:[y],decls:9,vars:7,consts:[[3,"pageHeaderInfo"],[1,"normal-table-wrap"],[3,"btnTpl","tableTitle","reload"],[3,"tableConfig","tableData","changePageNum","changePageSize"],["operationTpl",""],["tableBtns",""],[3,"entity","isVisible","isVisibleChange","onSuccess"],[1,"operate-text",3,"click"],["nz-button","","nzType","primary",1,"m-r-8",3,"click"],["nz-icon","","nzType","plus"]],template:function(t,n){if(t&1&&(u(0,"app-page-header",0),r(1,"div",1)(2,"app-card-table-wrap",2),h("reload",function(){return n.getDataList()}),r(3,"app-ant-table",3),h("changePageNum",function(c){return n.getDataList(c)})("changePageSize",function(c){return n.changePageSize(c)}),o(),C(4,We,4,0,"ng-template",null,4,k),o()(),C(6,Qe,3,0,"ng-template",null,5,k),r(8,"app-three-edit",6),h("isVisibleChange",function(c){return n.isEditVisible=c})("onSuccess",function(){return n.getDataList()}),o()),t&2){let s=B(7);m("pageHeaderInfo",n.pageHeaderInfo),p(2),m("btnTpl",s)("tableTitle","\u4E09\u4F1A\u4E00\u8BFE"),p(1),m("tableConfig",n.tableConfig)("tableData",n.dataList),p(5),m("entity",n.selectedEntity)("isVisible",n.isEditVisible)}},dependencies:[oe,re,ie,ne,Ee,Ve,xe,ke]});let i=a;return i})();export{wt as ThreeComponent};
