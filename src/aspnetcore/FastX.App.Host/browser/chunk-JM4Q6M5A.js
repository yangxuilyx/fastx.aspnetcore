import{b as U,f as W}from"./chunk-GGEG7LNG.js";import{a as re,f as J,k as X}from"./chunk-QA3WNWTC.js";import{a as d}from"./chunk-HLMBJXKN.js";import{ia as H,ja as K}from"./chunk-R2HTRB5T.js";import{v as Q}from"./chunk-FBUG2U6C.js";import{Db as E,Ea as _,Fc as P,Ha as w,Jb as x,Kb as C,Lb as F,Lc as q,Pb as O,Q as v,Xb as I,Zb as p,aa as h,db as k,g as y,ga as m,hc as $,jb as D,ka as z,kc as L,ma as a,nb as R,o as M,oa as T,pc as N,qc as Z,ta as S,tb as j,ua as g,vc as A,wc as V,yc as G,zc as B}from"./chunk-25RHYGPJ.js";import{g as le}from"./chunk-W7ODNIXK.js";var f=(()=>{let n=class n{constructor(){this.modalFullStatusStore$=new y(!1)}setModalFullStatusStore(t){this.modalFullStatusStore$.next(t)}getModalFullStatusStore(){return this.modalFullStatusStore$.asObservable()}};n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();var ae=["componentTpl"];function se(o,n){if(o&1){let i=O();x(0,"span",1),I("click",function(e){S(i);let l=p();return g(l.fullScreenIconClick(e))}),F(1,"i",2),N(2,"async"),C(),x(3,"span",3),I("click",function(){S(i);let e=p();return g(e.closeModal())}),F(4,"i",4),C()}if(o&2){let i=p();D(1),j("nzType",Z(2,1,i.modalFullStatus$)?"fullscreen-exit":"fullscreen")}}var b=class{constructor(){this.modalFullScreenFlag=!1}},ee=(()=>{let n=class n{constructor(){this.modalFullScreenFlag=!1,this.modalFullStatus=a(f),this.modalFullStatus$=this.modalFullStatus.getModalFullStatusStore(),this.modalFullStatus$.pipe(d()).subscribe(t=>this.modalFullScreenFlag=t)}fullScreenIconClick(t){this.modalFullScreenFlag=!this.modalFullScreenFlag,this.modalFullStatus.setModalFullStatusStore(this.modalFullScreenFlag),U(t)}closeModal(){this.modalFullScreenFlag=!1,this.modalFullStatus.setModalFullStatusStore(!1)}};n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=T({type:n,selectors:[["app-global-modal-btn-tpl"]],viewQuery:function(e,l){if(e&1&&V(ae,7),e&2){let r;A(r=G())&&(l.componentTpl=r.first)}},standalone:!0,features:[$([{provide:b,useExisting:n}]),L],decls:2,vars:0,consts:[["componentTpl",""],[1,"hover-blue","full-height","flex-auto","text-right","d-i-b",3,"click"],["nz-icon","","nzTheme","outline",1,"m-r-8",3,"nzType"],[1,"hover-red","full-height","flex-auto","d-i-b","m-r-15",3,"click"],["nz-icon","","nzTheme","outline","nzType","close"]],template:function(e,l){e&1&&E(0,se,5,3,"ng-template",null,0,B)},dependencies:[K,H,Q],encapsulation:2,changeDetection:0});let o=n;return o})();var te=new z("modal action btn token",{providedIn:"root",factory:()=>{let o=a(P),n=a(_),i=q(ee,{environmentInjector:n});return o.attachView(i.hostView),i}});var oe=le(re());var ne=class{constructor(n){this.modalRef=n}},Ee=(()=>{let n=class n{constructor(){this.destroyRef=a(R),this.baseInjector=a(w),this.modalFullStatusStoreService=a(f),this.dragDrop=a(J),this.rendererFactory=a(k),this.btnComponentRef=a(te),this.bsModalService=this.baseInjector.get(X),this.renderer=this.rendererFactory.createRenderer(null,null),this.btnTpl=this.btnComponentRef.instance.componentTpl,this.modalFullStatusStoreService.getModalFullStatusStore().pipe(d()).subscribe(t=>{this.fullScreenIconClick(t)})}fullScreenIconClick(t){this.bsModalService.openModals.forEach(e=>{t?this.renderer.addClass(e.containerInstance.host.nativeElement,"fullscreen-modal"):this.renderer.removeClass(e.containerInstance.host.nativeElement,"fullscreen-modal")})}getRandomCls(){return`NZ-MODAL-WRAP-CLS-${W()}`}cancelCallback(t){return this.modalFullStatusStoreService.setModalFullStatusStore(!1),t.modalRef.destroy({status:0,value:null})}confirmCallback(t){t.modalRef.componentInstance.getCurrentValue().pipe(h(e=>(this.modalFullStatusStoreService.setModalFullStatusStore(!1),e?t.modalRef.destroy({status:1,modalValue:e}):M(!1))),d(this.destroyRef)).subscribe()}getZIndex(t){return+getComputedStyle(t,null).zIndex}getModalMaxZIndex(t){return this.bsModalService.openModals.reduce((e,l)=>{let r=l.containerInstance.host.nativeElement;if(t===r)return e;let s=this.getZIndex(r);return s>=e.zIndex&&(e.zIndex=s,e.canChange=!0),e},{zIndex:this.getZIndex(t),canChange:!1})}setMaxZIndex(t){t.addEventListener("mousedown",()=>{let e=this.getModalMaxZIndex(t);e.canChange&&(t.style.zIndex=`${e.zIndex+1}`)},!1)}createDrag(t){let e=document.querySelector(`.${t}`),l=e.querySelector(".ant-modal-content"),r=l.querySelector(".ant-modal-header"),s=this.getModalMaxZIndex(e);return s.canChange&&(e.style.zIndex=`${s.zIndex+1}`),this.setMaxZIndex(e),r?(r.className+=" hand-model-move",this.dragDrop.createDrag(r).withHandles([r]).withRootElement(l)):this.dragDrop.createDrag(l).withHandles([l])}fixedWrapElementStyle(t){t.style.pointerEvents="none"}createModalConfig(t,e={},l,r){let s={nzTitle:"",nzContent:t,nzCloseIcon:e.nzCloseIcon||this.btnTpl,nzMaskClosable:!1,nzFooter:[{label:"\u786E\u8BA4",type:"primary",show:!0,onClick:this.confirmCallback.bind(this)},{label:"\u53D6\u6D88",type:"default",show:!0,onClick:this.cancelCallback.bind(this)}],nzOnCancel:()=>new Promise(u=>{u({status:0,value:null})}),nzClosable:!0,nzWidth:720,nzData:l},c=oe.merge(s,e);return c.nzWrapClassName=`${c.nzWrapClassName||""} ${r}`,c}show(t,e={},l){let r=this.getRandomCls(),s=this.createModalConfig(t,e,l,r),c=this.bsModalService.create(s),u;return c.afterOpen.pipe(v()).subscribe(()=>{u=this.createDrag(r)}),c.afterClose.pipe(h(()=>{u.dispose(),u=null,this.modalFullStatusStoreService.setModalFullStatusStore(!1)}))}};n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();export{ne as a,Ee as b};
