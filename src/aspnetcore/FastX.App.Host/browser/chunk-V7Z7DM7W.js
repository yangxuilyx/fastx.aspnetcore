import{a as we}from"./chunk-A3WD77X6.js";import{a as Te,b as Ie}from"./chunk-3LEP76YH.js";import{a as Fe,b as De}from"./chunk-LFYJK5GB.js";import{b as xe,c as Ve}from"./chunk-NN5I4ZQ6.js";import{a as ye,b as Se,c as Ee}from"./chunk-36JYQPX4.js";import"./chunk-JQ4W37JH.js";import"./chunk-GOVML6XL.js";import{b as ve}from"./chunk-JM4Q6M5A.js";import{a as Z}from"./chunk-GGEG7LNG.js";import{k as ge,l as Ce,m as ze,n as be}from"./chunk-QA3WNWTC.js";import"./chunk-ZV26Q6Z5.js";import"./chunk-4V3WCFNY.js";import{R as se,S as me,T as pe,U as ce,V as de,ba as ue,d as H,e as C,f as W,fa as fe,g as G,k as Q,l as $,o as J,q as K,r as X,s as Y,v as re,w as le}from"./chunk-K3UCEQBL.js";import"./chunk-HLMBJXKN.js";import{a as Ne}from"./chunk-AAN5EPXW.js";import"./chunk-TH67R3V7.js";import"./chunk-3OVYBGXJ.js";import"./chunk-C6FDTAOV.js";import"./chunk-IUQ3UXTC.js";import{Na as ie,Oa as ne,Qa as oe,Ra as ae,gb as he,ia as ee,ja as te,jb as I,kb as _e}from"./chunk-R2HTRB5T.js";import"./chunk-HDIAUTON.js";import{w as A}from"./chunk-YRUIOUIJ.js";import{p as V,y as T}from"./chunk-FBUG2U6C.js";import{$a as O,Db as g,Fb as k,Hb as L,Ib as R,Jb as a,Kb as r,Lb as d,Mb as D,Nb as w,P as N,Pb as E,Xb as f,Zb as h,bc as P,cc as c,jb as p,kb as _,kc as x,lc as U,ma as z,mb as S,oa as y,ob as F,ta as b,tb as m,ua as v,vc as q,wc as B,yc as j,zc as M}from"./chunk-25RHYGPJ.js";import"./chunk-W7ODNIXK.js";function Ue(i,o){if(i&1&&d(0,"nz-option",13),i&2){let l=o.$implicit;m("nzLabel",l.name)("nzValue",l.ouId)}}function qe(i,o){if(i&1&&(D(0),d(1,"span",14),a(2,"div",15),c(3,"Upload"),r(),w()),i&2){let l=h(2);p(1),m("nzType",l.loading?"loading":"plus")}}function Be(i,o){if(i&1&&d(0,"img",16),i&2){let l=h(2);m("src",l.avatarUrl,O)}}function je(i,o){if(i&1&&(D(0),a(1,"form",2)(2,"nz-form-item")(3,"nz-form-label",3),c(4,"\u53D1\u5E03\u7EC4\u7EC7"),r(),a(5,"nz-form-control")(6,"nz-select",4),L(7,Ue,1,2,"nz-option",13,k),r()()(),a(9,"nz-form-item")(10,"nz-form-label",5),c(11,"\u6807\u9898"),r(),a(12,"nz-form-control"),d(13,"input",6),r()(),a(14,"nz-form-item")(15,"nz-form-label",5),c(16,"\u5C01\u9762\u56FE"),r(),a(17,"nz-form-control")(18,"nz-upload",7),g(19,qe,4,1,"ng-container",8)(20,Be,1,1,"img",9),r()()(),a(21,"nz-form-item")(22,"nz-form-label",5),c(23,"\u9605\u8BFB\u79EF\u5206"),r(),a(24,"nz-form-control"),d(25,"nz-input-number",10),r()(),a(26,"nz-form-item")(27,"nz-form-label",5),c(28,"\u6392\u5E8F"),r(),a(29,"nz-form-control"),d(30,"nz-input-number",11),r()(),a(31,"nz-form-item")(32,"nz-form-control"),d(33,"app-wang-editor",12),r()()(),w()),i&2){let l=h();p(1),m("formGroup",l.validateForm),p(6),R(l.ous),p(11),m("nzShowUploadList",!1)("nzCustomRequest",l.nzCustomRequest),p(1),m("ngIf",!l.avatarUrl),p(1),m("ngIf",l.avatarUrl),p(5),m("nzMin",0),p(5),m("nzMin",0),p(3),m("height",500)}}var Ae=()=>({padding:"15px",height:"70vh","max-height":"100vh"}),Me=(()=>{let o=class o{get isVisible(){return this._isVisible}set isVisible(e){this._isVisible=e,e&&(this.validateForm.patchValue({type:this.type}),this.entity&&this.validateForm.patchValue(this.entity))}constructor(e,n,t,s){this.client=e,this.fb=n,this.ouClient=t,this.fileClient=s,this._isVisible=!1,this.isVisibleChange=new F,this.onSuccess=new F,this.validateForm=this.fb.group({notiId:[],title:[null,[C.required]],pic:[null,[C.required]],integral:[0,[C.required]],status:[0,[C.required]],sort:[0],content:["",[C.required]],notiOus:[[],[C.required]],type:[0]}),this.loading=!1,this.cdr=z(S),this.nzCustomRequest=u=>(this.loading=!0,this.fileClient.upload({data:u.file,fileName:u.file.name}).pipe(N(()=>{this.loading=!1})).subscribe(Oe=>{this.avatarUrl=Oe.url})),this.ous=[]}get avatarUrl(){return this.validateForm.value.pic?this.fileClient.getBaseUrl("")+"/"+this.validateForm.value.pic:""}set avatarUrl(e){this.validateForm.controls.pic.setValue(e),this.validateForm.value.pic=e,this.cdr.detectChanges()}ngOnInit(){this.getSelectData()}getSelectData(){this.ouClient.getAll().subscribe(e=>{this.ous=e})}handleCancel(){this.validateForm.reset(),this.isVisibleChange.emit(!1)}handleOk(){Z(this.validateForm)&&this.client.insertOrUpdate(this.validateForm.value).subscribe(()=>{this.onSuccess.emit(),this.handleCancel()})}};o.\u0275fac=function(n){return new(n||o)(_(I),_(K),_(_e),_(he))},o.\u0275cmp=y({type:o,selectors:[["app-noti-edit"]],inputs:{isVisible:"isVisible",entity:"entity",type:"type"},outputs:{isVisibleChange:"isVisibleChange",onSuccess:"onSuccess"},standalone:!0,features:[x],decls:2,vars:3,consts:[["nzTitle","\u7F16\u8F91\u901A\u77E5","nzxModalDrag","","nzWidth","60%",3,"nzVisible","nzBodyStyle","nzVisibleChange","nzOnCancel","nzOnOk"],[4,"nzModalContent"],["nz-form","",3,"formGroup"],["nzRequired","","nzSpan","2"],["nzAllowClear","","nzShowSearch","","nzMode","multiple","formControlName","notiOus"],["nzSpan","2","nzRequired",""],["nz-input","","formControlName","title"],["nzName","avatar","nzListType","picture-card",1,"avatar-uploader",3,"nzShowUploadList","nzCustomRequest"],[4,"ngIf"],["style","width: 100%",3,"src",4,"ngIf"],["formControlName","integral",3,"nzMin"],["formControlName","sort",3,"nzMin"],["formControlName","content",3,"height"],[3,"nzLabel","nzValue"],["nz-icon","",1,"upload-icon",3,"nzType"],[1,"ant-upload-text"],[2,"width","100%",3,"src"]],template:function(n,t){n&1&&(a(0,"nz-modal",0),f("nzVisibleChange",function(u){return t.isVisible=u})("nzOnCancel",function(){return t.handleCancel()})("nzOnOk",function(){return t.handleOk()}),g(1,je,34,8,"ng-container",1),r()),n&2&&m("nzVisible",t.isVisible)("nzBodyStyle",U(2,Ae))},dependencies:[T,V,X,Q,H,W,G,Y,$,J,de,le,re,me,se,ce,pe,be,ze,Ce,Ee,ye,Se,fe,ue,Ie,Te,we,De,Fe,te,ee]});let i=o;return i})();var He=["operationTpl"];function We(i,o){if(i&1){let l=E();a(0,"span",8),f("click",function(){b(l);let n=h().item,t=h();return v(t.send(n))}),c(1,"\u53D1\u5E03"),r()}}function Ge(i,o){if(i&1){let l=E();g(0,We,2,0,"span",7),a(1,"span",8),f("click",function(){let t=b(l).item,s=h();return v(s.edit(t))}),c(2,"\u7F16\u8F91"),r(),a(3,"span",8),f("click",function(){let t=b(l).item,s=h();return v(s.del(t))}),c(4,"\u5220\u9664"),r()}if(i&2){let l=o.item;m("ngIf",l.status==0)}}function Qe(i,o){if(i&1){let l=E();a(0,"button",9),f("click",function(){b(l);let n=h();return v(n.add())}),d(1,"i",10),c(2," \u65B0\u5EFA "),r()}}var Ot=(()=>{let o=class o{constructor(e,n,t){this.client=e,this.modalService=n,this.activeRoute=t,this.pageHeaderInfo={breadcrumb:["\u9996\u9875","\u5BA3\u4F20\u7BA1\u7406","\u515A\u5EFA\u52A8\u6001"]},this.cdr=z(S),this.modalWrapService=z(ve),this.dataList=[],this.searchParam={},this.isEditVisible=!1}ngOnInit(){let e=parseInt(this.activeRoute.snapshot.data.type);this.searchParam.notiType=e,e==1&&(this.pageHeaderInfo.breadcrumb=["\u9996\u9875","\u5BA3\u4F20\u7BA1\u7406","\u7EC4\u7EC7\u6D3B\u52A8"]),this.initTable()}initTable(){this.tableConfig={headers:[{title:"\u6807\u9898",field:"title",width:200},{title:"\u79EF\u5206",field:"integral"},{title:"\u53D1\u5E03\u72B6\u6001",field:"statusDesc"},{title:"\u6392\u5E8F",field:"sort"},{title:"\u64CD\u4F5C",tdTemplate:this.operationTpl,width:120,fixed:!0,fixedDir:"right"}],total:0,showCheckbox:!1,loading:!1,pageSize:10,pageIndex:1}}getDataList(e){this.tableConfig.loading=!0,this.searchParam.page={pageSize:this.tableConfig.pageSize,pageIndex:e?.pageIndex||this.tableConfig.pageIndex},this.client.list(this.searchParam).pipe(N(()=>{this.tableLoading(!1)})).subscribe(n=>{let{items:t,page:s}=n;this.dataList=[...t],this.tableConfig.total=s.totalCount,this.tableConfig.pageIndex=s.pageIndex,this.tableLoading(!1)})}add(){this.selectedEntity=null,this.isEditVisible=!0}edit(e){this.selectedEntity=e,this.isEditVisible=!0}del(e){this.modalService.confirm({nzTitle:"\u786E\u5B9A\u5220\u9664?",nzOnOk:()=>{this.client.delete(e.notiId).subscribe(n=>{this.getDataList()})}})}send(e){this.client.send(e.notiId).subscribe(n=>{this.getDataList()})}tableLoading(e){this.tableConfig.loading=e,this.tableChangeDectction()}tableChangeDectction(){this.dataList=[...this.dataList],this.cdr.detectChanges()}changePageSize(e){this.tableConfig.pageSize=e}};o.\u0275fac=function(n){return new(n||o)(_(I),_(ge),_(A))},o.\u0275cmp=y({type:o,selectors:[["app-noti"]],viewQuery:function(n,t){if(n&1&&B(He,7),n&2){let s;q(s=j())&&(t.operationTpl=s.first)}},standalone:!0,features:[x],decls:9,vars:8,consts:[[3,"pageHeaderInfo"],[1,"normal-table-wrap"],[3,"btnTpl","tableTitle","reload"],[3,"tableConfig","tableData","changePageNum","changePageSize"],["operationTpl",""],["tableBtns",""],[3,"type","entity","isVisible","isVisibleChange","onSuccess"],["class","operate-text",3,"click",4,"ngIf"],[1,"operate-text",3,"click"],["nz-button","","nzType","primary",1,"m-r-8",3,"click"],["nz-icon","","nzType","plus"]],template:function(n,t){if(n&1&&(d(0,"app-page-header",0),a(1,"div",1)(2,"app-card-table-wrap",2),f("reload",function(){return t.getDataList()}),a(3,"app-ant-table",3),f("changePageNum",function(u){return t.getDataList(u)})("changePageSize",function(u){return t.changePageSize(u)}),r(),g(4,Ge,5,1,"ng-template",null,4,M),r()(),g(6,Qe,3,0,"ng-template",null,5,M),a(8,"app-noti-edit",6),f("isVisibleChange",function(u){return t.isEditVisible=u})("onSuccess",function(){return t.getDataList()}),r()),n&2){let s=P(7);m("pageHeaderInfo",t.pageHeaderInfo),p(2),m("btnTpl",s)("tableTitle","\u901A\u77E5\u5217\u8868"),p(1),m("tableConfig",t.tableConfig)("tableData",t.dataList),p(5),m("type",t.searchParam.notiType)("entity",t.selectedEntity)("isVisible",t.isEditVisible)}},dependencies:[T,V,ae,oe,ie,ne,Ne,Ve,xe,Me]});let i=o;return i})();export{Ot as NotiComponent};
